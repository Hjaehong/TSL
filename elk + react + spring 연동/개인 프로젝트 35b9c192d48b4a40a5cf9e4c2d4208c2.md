# ê°œì¸ í”„ë¡œì íŠ¸

<aside>
ğŸ’¡ mac m1 ê¸°ì¤€

</aside>

# ELK + springboot + react

> ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ + ë¡œê·¸ìŠ¤í…Œì‹œ + í‚¤ë°”ë‚˜ = ELK
> 

## ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ ì„¸íŒ…(zip ê¸°ì¤€)

> ì—˜ë¼ìŠ¤í‹± ìŠ¤í…ì˜ ë¶„ì‚° ê²€ìƒ‰ ë° ë¶„ì„ ì—”ì§„
> 

ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì•ˆì— jdkê°€ ë‚´ì¥ë˜ì–´ ìˆì§€ë§Œ ìì²´ì ì¸ jvmì„ ì“°ê³  ì‹¶ë‹¤ë©´ es_java_home í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•´ì•¼í•¨

í‚¤ë°”ë‚˜ ë¡œê·¸ìŠ¤íƒœì‹œ ì—˜ë¼ìŠ¤í‹±ë“± ë²„ì „ì€ ë‹¤ ë§ì¶°ì¤˜ì•¼í•œë‹¤.

## ë„ì»¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë²•

[Run Elasticsearch locally | Elasticsearch Guide [8.6] | Elastic](https://www.elastic.co/guide/en/elasticsearch/reference/current/run-elasticsearch-locally.html)

## ë¡œì»¬ë¡œ ì„¤ì¹˜

ì—˜ë¼ìŠ¤í‹± â†’ í‚¤ë°”ë‚˜ â†’ ë¡œê·¸ìŠ¤í…Œì‹œ ìˆœìœ¼ë¡œ ì§„í–‰

### **ì—˜ë¼ìŠ¤í‹± ì…‹íŒ…**

**ë³´ì•ˆì„¤ì •**

8.4.2ë²„ì „ ë¶€í„° ì—˜ë¼ìŠ¤í‹±ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ ë³´ì•ˆ ì²˜ë¦¬ê°€ ë˜ì–´ìˆì–´ì„œ ì´ì „ë²„ì „ì²˜ëŸ¼ 

[localhost:9200](http://localhost)ì—ì„œ ì ‘ì†í•˜ê¸° ìœ„í•´ì„  ì•„ë˜ì²˜ëŸ¼ ë³´ì•ˆê¸°ëŠ¥ë“¤ì„ í•´ì œ í•´ì¤˜ì•¼í•œë‹¤.

**í¬íŠ¸ì„¤ì •**

ê¸°ë³¸ì ìœ¼ë¡  9200 í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ ë³€ê²½í•˜ê³  ì‹¶ë‹¤ë©´ http.portë¥¼ ìˆ˜ì •í•´ì£¼ë©´ ë³€ê²½ì´ ëœë‹¤

ymlíŒŒì¼ 

```yaml
xpack.security.enabled: false

xpack.security.enrollment.enabled: false

xpack.security.http.ssl:
  enabled: false

xpack.security.transport.ssl:
  enabled: false

```

---

### **ì—˜ë¼ìŠ¤í‹± ì‹¤í–‰**

í„°ë¯¸ë„ì—ì„œ ì—˜ë¼ìŠ¤í‹±ì´ ì„¤ì¹˜ëœ íŒŒì¼ë¡œ ì´ë™

**ì‹¤í–‰**

bin/elasticsearch ëª…ë ¹ì–´ë¡œ ì—˜ë¼ìŠ¤í‹± ì‹¤í–‰

![ë§Œì•½ biní´ë”ì— ë“¤ì–´ê°€ì„œ ì‹¤í–‰ì‹œ ./ì„ ë¶™ì—¬ì„œ ì‹¤í–‰ ./elasticsearch](%E1%84%80%E1%85%A2%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%2035b9c192d48b4a40a5cf9e4c2d4208c2/Untitled.png)

ë§Œì•½ biní´ë”ì— ë“¤ì–´ê°€ì„œ ì‹¤í–‰ì‹œ ./ì„ ë¶™ì—¬ì„œ ì‹¤í–‰ ./elasticsearch

ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ë¥¼ í„°ë¯¸ë„ì—ì„œ ì¢…ë£Œí•˜ê³  ì‹¶ë‹¤ë©´ ctrl + c ë¡œ ì¢…ë£Œ

![Untitled](%E1%84%80%E1%85%A2%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%2035b9c192d48b4a40a5cf9e4c2d4208c2/Untitled%201.png)

**í™•ì¸**

í„°ë¯¸ë„ì—ì„œ í™•ì¸í•˜ëŠ” ë°©ë²•

1. í„°ë¯¸ë„ ìƒˆë¡œìš´ ì°½ì„ ìƒì„±í•˜ì—¬ curl -X GET â€œlocalhost:9200/?prettyâ€ ì…ë ¥

![Untitled](%E1%84%80%E1%85%A2%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%2035b9c192d48b4a40a5cf9e4c2d4208c2/Untitled%202.png)

1. ì¸í„°ë„·ì°½ì— [localhost:9200](http://localhost:9200) ì…ë ¥

![Untitled](%E1%84%80%E1%85%A2%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%2035b9c192d48b4a40a5cf9e4c2d4208c2/Untitled%203.png)

### í‚¤ë°”ë‚˜ ì…‹íŒ…

ì—˜ë¼ìŠ¤í‹± ì„œì¹˜ì™€ ë™ì¼í•˜ê²Œ config íŒŒì¼ ë‚´ì— ymlíŒŒì¼ì—ì„œ ì„¤ì •í•œë‹¤

server.port: í‚¤ë°”ë‚˜ì— ì ‘ì†í•  í¬íŠ¸ë¥¼ ì„¤ì • ê¸°ë³¸ì ìœ¼ë¡  **5601**ìœ¼ë¡œ ì„¤ì •

### í‚¤ë°”ë‚˜ ì‹¤í–‰

í„°ë¯¸ë„ë¡œ í‚¤ë°”ë‚˜ê°€ ì„¤ì¹˜ëœ ê²½ë¡œ ì´ë™, ì—˜ë¼ìŠ¤í‹±ì„œì¹˜ì™€ ê°™ì´ bin/kibanaë¡œ ì‹¤í–‰

![error ì—†ì´ kibana is now availableì´ ì œëŒ€ë¡œ í™•ì¸ë˜ë©´ ì˜¬ë°”ë¥´ê²Œ ì‹¤í–‰ëœê²ƒ ](%E1%84%80%E1%85%A2%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%2035b9c192d48b4a40a5cf9e4c2d4208c2/Untitled%204.png)

error ì—†ì´ kibana is now availableì´ ì œëŒ€ë¡œ í™•ì¸ë˜ë©´ ì˜¬ë°”ë¥´ê²Œ ì‹¤í–‰ëœê²ƒ 

![5601ì€ ë„ì»¤ì—ì„œ ì‚¬ìš©ì¤‘ì´ì—¬ì„œ ymlíŒŒì¼ë¡œ 5602ë¡œ ì ‘ì†í•˜ê²Œ ë³€ê²½](%E1%84%80%E1%85%A2%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%2035b9c192d48b4a40a5cf9e4c2d4208c2/Untitled%205.png)

5601ì€ ë„ì»¤ì—ì„œ ì‚¬ìš©ì¤‘ì´ì—¬ì„œ ymlíŒŒì¼ë¡œ 5602ë¡œ ì ‘ì†í•˜ê²Œ ë³€ê²½

ì¸í„°ë„·ë¸Œë¼ìš°ì €ì—ì„œ localhost:5601ë¥¼ ì…ë ¥í•˜ì—¬ í‚¤ë°”ë‚˜ì— ì ‘ì†

## ë¡œê·¸ìŠ¤í…Œì‹œì™€ ìŠ¤í”„ë§ slf4j ì—°ê²°í•˜ì—¬ ë¡œê·¸ ì½ê¸°

### ë¡œê·¸ìŠ¤í…Œì‹œ ì„¤ì •

ë¡œê·¸ìŠ¤í…Œì‹œ configíŒŒì¼ì•ˆì— logstash-sampleíŒŒì¼ì„ ë³µì‚¬í•˜ì—¬ biní´ë”ì•ˆì— ì €ì¥

ë¡œê·¸ìŠ¤í…Œì‹œë¥¼ ì‚¬ìš©í•˜ê¸° ì „ configíŒŒì¼ì„ ìƒì„±í•˜ì—¬ ì„¤ì •í•´ì¤˜ì•¼í•œë‹¤.

- codec ê´€ë ¨ ì°¸ê³  ìë£Œ
    
    [Json codec plugin | Logstash Reference [8.6] | Elastic](https://www.elastic.co/guide/en/logstash/current/plugins-codecs-json.html)
    

```yaml
input{
  tcp{
    port => 4560
		# ì½ì„ íŒŒì¼ì•ˆì— \n ì´ ë“¤ì–´ìˆë‹¤ë©´ json_lineìœ¼ë¡œ ë°”ê¿”ì¤€ë‹¤.
    codec => json
  }
}

output {
  elasticsearch {
    hosts => ["http://localhost:9200"]
    index => "elk-spring-log-%{+YYYY.MM.dd}"
  }
}
```

![Untitled](%E1%84%80%E1%85%A2%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%2035b9c192d48b4a40a5cf9e4c2d4208c2/Untitled%206.png)

slf4jë¥¼ ì‚¬ìš©í•˜ì—¬ log.infoë¡œ ë¡œê·¸ë“¤ì„ ì¶œë ¥í•œë‹¤.

í•´ë‹¹ ë¡œê·¸ë¥¼ ë¡œê·¸ìŠ¤í…Œì‹œê°€ ì½ì„ ìˆ˜ ìˆë„ë¡ ì„¤ì •

- ì°¸ê³ ë¬¸ì„œ
    
    [GitHub - logfellow/logstash-logback-encoder: Logback JSON encoder and appenders](https://github.com/logfellow/logstash-logback-encoder#tcp-appenders)
    
1. logbackë¥¼ ê·¸ë˜ë“¤ ì„¤ì •íŒŒì¼ì— ì„ ì–¸
    
    ```groovy
    dependencies {
        implementation 'net.logstash.logback:logstash-logback-encoder:7.2'
    }
    ```
    
2. logback ì„¤ì • ì„ ìœ„í•œ xml íŒŒì¼
    
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    
    <!-- ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ì¤‘ì¼ ë–„ ì¬ì‹œì‘ ì—†ì´ ì„¤ì •ì„ 30ì´ˆ ì£¼ê¸°ë¡œ ì½ê¸° -->
    <configuration scan="true" scanPeriod="30 seconds">
    		<!-- ë¡œê·¸ìŠ¤íƒœì‹œ confíŒŒì¼ì— ì„¤ì •í•œ inputê°’ì— ë§ê²Œ ì„¤ì •  -->
        <appender name="stash" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
            <destination>13.209.52.172:4560</destination>
            <encoder class="net.logstash.logback.encoder.LogstashEncoder"></encoder>
        </appender>
    
        <!-- rootë ˆë²¨ ì„¤ì • -->
        <root level="DEBUG">
            <appender-ref ref="stash" />
        </root>
    
    </configuration>
    ```
    
    - logback
        
        Logger, Appender, Layoutìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.
        
        Logger : logback-classic ëª¨ë“ˆ
        
        Appender, Layout : logback-core ëª¨ë“ˆ
        

### ë¡œê·¸ìŠ¤íƒœì‹œ ì‹¤í–‰

bin/logstash -f bin/logstash.conf

-f : íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì‹¤í–‰í•  conf íŒŒì¼ì˜ ì´ë¦„

![Untitled](%E1%84%80%E1%85%A2%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%2035b9c192d48b4a40a5cf9e4c2d4208c2/Untitled%207.png)

í‚¤ë°”ë‚˜ stack management > data view > create data view ë¥¼ ëˆ„ë¥¸ë‹¤.

![Untitled](%E1%84%80%E1%85%A2%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%2035b9c192d48b4a40a5cf9e4c2d4208c2/Untitled%208.png)

ë¡œê·¸ìŠ¤íƒœì‹œ ì‹¤í–‰í• ë•Œ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì„¤ì •í•œ íŒŒì¼ì•ˆ elasticsearch ì˜ indexëª…ìœ¼ë¡œ ì™¼ìª½ index patternì— ë‚˜íƒ€ë‚œë‹¤

ì´ë¦„ê³¼ ì‚¬ìš©í•  index patternì„ ì§€ì •í•˜ê³  ì €ì¥í•œë‹¤.

![Untitled](%E1%84%80%E1%85%A2%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A6%E1%86%A8%E1%84%90%E1%85%B3%2035b9c192d48b4a40a5cf9e4c2d4208c2/Untitled%209.png)

discoverì—ì„œ ë¡œê·¸ë“¤ì„ ë³¼ ìˆ˜ ìˆë‹¤.

ì—°ê²° ì™„ë£Œ