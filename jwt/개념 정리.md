#JWT? (JSON WEB TOKEN) 

인터넷에서 정보를 안전하게 전송하기 위한 토큰 기반의 인증 방식

## 구성요소 

1. Header : 토큰에 대한 메타 정보를 담고 있다.
2. Payload : 토큰에 담을 클레임(claim) 정보가 포함되어 있다, 클레임은 이름-값 으로 이루어져 있고 등록된 클레임, 공개 클레임, 비공개 클레임 세 가지 유형이 있다.
3. Signature : 토큰의 유효성 검증을 위한 서명


## spring Security 와 jwt 인증방식 이용 하기

### 1. application.properties, application.yml 파일에 jwt의 secert 지정 
-> .yml 파일 기준
```groovy
jwt:
  secret: 일정한 길이의 텍스트 or base64같은 인코딩을 이용하여 설정

```
토큰의 서명을 생성하고 검증하는 데 사용
- signature 생성 : secert은 header와 payload를 인코딩하고 합친 뒤, 데이터에 대해 해시를 계산 하여 서명을 생성하는 데 사용
-> 토큰의 무결성과 인증을 보장하는데 중요한 역할을 함
- 토큰 검증 : 서버 측에서는 이 secert을 사용해 받은 토큰의 서명을 검증한다.
    i. 서버는 Header와 payload를 동일한 알고리즘으로 해시하여 서명을 생성
    ii. 토큰에 포함된 서명과 일치하는지 확인

### 해당 부분이 없을 경우 

1. 토큰의 무결성을 위반
2. 인증 실패
3. 신뢰성 저하 


### 2. 토큰을 공급하는 클래스 생성


```java

public class TokenProvider {

    // JWT 토큰의 클레임에서 권한 정보를 저장하는데 사용되는 키
    private static final String AUTHORITIES_KEY = "auth";
    // 토큰의 타입, OAtuth 2.0 과 같은 인증 체계에서 사용되는 토큰 
    // Authorization: Bearer <token>
    private static final String BEARER_TYPE = "bearer";
    // 토큰 만료 시간
    private static final long ACCESS_TOKEN_EXPIRE_TIME = 1000 * 60 * 60 * 24;     // 24시간
    private final UserService userService;
    // 키 값
    private final Key key;

    /*
     * @Value에서 jwt.secret은 application.yml의 jwt의 secert 부분을 의미
    */
    public TokenProvider(@Value("${jwt.secret}") String secretKey, UserService userService) {
        this.userDetailsService = userDetailsService;
        //secret값을 Base64 Decode해서 keyBytes 할당
        byte[] keyBytes = Decoders.BASE64.decode(secretKey);
        // jwt토큰을 만들기 위한 인증코드 생성, SHA 알고리즘 이용 하여 HMAC 키를 생성
        this.key = Keys.hmacShaKeyFor(keyBytes); 
    }


    public TokenDTO generateTokenDto(UserDTO user) {

        /*
         * DTO에서 권한들 ROLE_USER, ROLE_ADMIN ... 가져오기
         * singletonList로 권한들을 가져오는 이유는 여러명의 접속자들이 한번에 몰릴 수 있기 때문에 오류를 방지하고자 
         */ 
        List<String> roles = Collections.singletonList(user.getUserRole());
    }

```